#ifndef PY_UTIL_H
#define PY_UTIL_H

#define PY "^.*\\.pyc$"
#define PY_SIG "\xEE\x0C\r\n"
#define PY_HEADER_SIZE 12
#define HAVE_ARGUMENT 90

#define HAS_ARG(op) ((op) >= HAVE_ARGUMENT)

/* All further definitions are taken from CPython, latest revision */

const char* PY_OPCODES[256];

static void initialize_py_ops() {
  PY_OPCODES[1] = "POP_TOP";
  PY_OPCODES[2] = "ROT_TWO";
  PY_OPCODES[3] = "ROT_THREE";
  PY_OPCODES[4] = "DUP_TOP";
  PY_OPCODES[5] = "DUP_TOP_TWO";
  PY_OPCODES[9] = "NOP";
  PY_OPCODES[10] = "UNARY_POSITIVE";
  PY_OPCODES[11] = "UNARY_NEGATIVE";
  PY_OPCODES[12] = "UNARY_NOT";
  PY_OPCODES[15] = "UNARY_INVERT";
  PY_OPCODES[16] = "BINARY_MATRIX_MULTIPLY";
  PY_OPCODES[17] = "INPLACE_MATRIX_MULTIPLY";
  PY_OPCODES[19] = "BINARY_POWER";
  PY_OPCODES[20] = "BINARY_MULTIPLY";
  PY_OPCODES[22] = "BINARY_MODULO";
  PY_OPCODES[23] = "BINARY_ADD";
  PY_OPCODES[24] = "BINARY_SUBTRACT";
  PY_OPCODES[25] = "BINARY_SUBSCR";
  PY_OPCODES[26] = "BINARY_FLOOR_DIVIDE";
  PY_OPCODES[27] = "BINARY_TRUE_DIVIDE";
  PY_OPCODES[28] = "INPLACE_FLOOR_DIVIDE";
  PY_OPCODES[29] = "INPLACE_TRUE_DIVIDE";
  PY_OPCODES[54] = "STORE_MAP";
  PY_OPCODES[55] = "INPLACE_ADD";
  PY_OPCODES[56] = "INPLACE_SUBTRACT";
  PY_OPCODES[57] = "INPLACE_MULTIPLY";
  PY_OPCODES[59] = "INPLACE_MODULO";
  PY_OPCODES[60] = "STORE_SUBSCR";
  PY_OPCODES[61] = "DELETE_SUBSCR";
  PY_OPCODES[62] = "BINARY_LSHIFT";
  PY_OPCODES[63] = "BINARY_RSHIFT";
  PY_OPCODES[64] = "BINARY_AND";
  PY_OPCODES[65] = "BINARY_XOR";
  PY_OPCODES[66] = "BINARY_OR";
  PY_OPCODES[67] = "INPLACE_POWER";
  PY_OPCODES[68] = "GET_ITER";
  PY_OPCODES[70] = "PRINT_EXPR";
  PY_OPCODES[71] = "LOAD_BUILD_CLASS";
  PY_OPCODES[72] = "YIELD_FROM";
  PY_OPCODES[75] = "INPLACE_LSHIFT";
  PY_OPCODES[76] = "INPLACE_RSHIFT";
  PY_OPCODES[77] = "INPLACE_AND";
  PY_OPCODES[78] = "INPLACE_XOR";
  PY_OPCODES[79] = "INPLACE_OR";
  PY_OPCODES[80] = "BREAK_LOOP";
  PY_OPCODES[81] = "WITH_CLEANUP";
  PY_OPCODES[83] = "RETURN_VALUE";
  PY_OPCODES[84] = "IMPORT_STAR";
  PY_OPCODES[86] = "YIELD_VALUE";
  PY_OPCODES[87] = "POP_BLOCK";
  PY_OPCODES[88] = "END_FINALLY";
  PY_OPCODES[89] = "POP_EXCEPT";
  PY_OPCODES[90] = "STORE_NAME";
  PY_OPCODES[91] = "DELETE_NAME";
  PY_OPCODES[92] = "UNPACK_SEQUENCE";
  PY_OPCODES[93] = "FOR_ITER";
  PY_OPCODES[94] = "UNPACK_EX";
  PY_OPCODES[95] = "STORE_ATTR";
  PY_OPCODES[96] = "DELETE_ATTR";
  PY_OPCODES[97] = "STORE_GLOBAL";
  PY_OPCODES[98] = "DELETE_GLOBAL";
  PY_OPCODES[100] = "LOAD_CONST";
  PY_OPCODES[101] = "LOAD_NAME";
  PY_OPCODES[102] = "BUILD_TUPLE";
  PY_OPCODES[103] = "BUILD_LIST";
  PY_OPCODES[104] = "BUILD_SET";
  PY_OPCODES[105] = "BUILD_MAP";
  PY_OPCODES[106] = "LOAD_ATTR";
  PY_OPCODES[107] = "COMPARE_OP";
  PY_OPCODES[108] = "IMPORT_NAME";
  PY_OPCODES[109] = "IMPORT_FROM";
  PY_OPCODES[110] = "JUMP_FORWARD";
  PY_OPCODES[111] = "JUMP_IF_FALSE_OR_POP";
  PY_OPCODES[112] = "JUMP_IF_TRUE_OR_POP";
  PY_OPCODES[113] = "JUMP_ABSOLUTE";
  PY_OPCODES[114] = "POP_JUMP_IF_FALSE";
  PY_OPCODES[115] = "POP_JUMP_IF_TRUE";
  PY_OPCODES[116] = "LOAD_GLOBAL";
  PY_OPCODES[119] = "CONTINUE_LOOP";
  PY_OPCODES[120] = "SETUP_LOOP";
  PY_OPCODES[121] = "SETUP_EXCEPT";
  PY_OPCODES[122] = "SETUP_FINALLY";
  PY_OPCODES[124] = "LOAD_FAST";
  PY_OPCODES[125] = "STORE_FAST";
  PY_OPCODES[126] = "DELETE_FAST";
  PY_OPCODES[130] = "RAISE_VARARGS";
  PY_OPCODES[131] = "CALL_FUNCTION";
  PY_OPCODES[132] = "MAKE_FUNCTION";
  PY_OPCODES[133] = "BUILD_SLICE";
  PY_OPCODES[134] = "MAKE_CLOSURE";
  PY_OPCODES[135] = "LOAD_CLOSURE";
  PY_OPCODES[136] = "LOAD_DEREF";
  PY_OPCODES[137] = "STORE_DEREF";
  PY_OPCODES[138] = "DELETE_DEREF";
  PY_OPCODES[140] = "CALL_FUNCTION_VAR";
  PY_OPCODES[141] = "CALL_FUNCTION_KW";
  PY_OPCODES[142] = "CALL_FUNCTION_VAR_KW";
  PY_OPCODES[143] = "SETUP_WITH";
  PY_OPCODES[144] = "EXTENDED_ARG";
  PY_OPCODES[145] = "LIST_APPEND";
  PY_OPCODES[146] = "SET_ADD";
  PY_OPCODES[147] = "MAP_ADD";
  PY_OPCODES[148] = "LOAD_CLASSDEREF";
}

enum PY_TYPES {
    TYPE_NULL = '0',
    TYPE_NONE = 'N',
    TYPE_FALSE = 'F',
    TYPE_TRUE = 'T',
    TYPE_STOPITER = 'S',
    TYPE_ELLIPSIS = '.',
    TYPE_INT = 'i',
    TYPE_FLOAT = 'f',
    TYPE_BINARY_FLOAT = 'g',
    TYPE_COMPLEX = 'x',
    TYPE_BINARY_COMPLEX = 'y',
    TYPE_LONG = 'l',
    TYPE_STRING = 's',
    TYPE_INTERNED = 't',
    TYPE_REF = 'r',
    TYPE_TUPLE = '(',
    TYPE_LIST = '[',
    TYPE_DICT = '{',
    TYPE_CODE = 'c',
    TYPE_UNICODE = 'u',
    TYPE_UNKNOWN = '?',
    TYPE_SET = '<',
    TYPE_FROZENSET = '>',
    FLAG_REF = '\x80',
    TYPE_ASCII = 'a',
    TYPE_ASCII_INTERNED = 'A',
    TYPE_SMALL_TUPLE = ')',
    TYPE_SHORT_ASCII = 'z',
    TYPE_SHORT_ASCII_INTERNED = 'Z',
};
#endif
